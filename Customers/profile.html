<script>
    var myUrl = new URL(document.location.href)
    var userID = myUrl.searchParams.get("id")
    
    let request = cbrRequest(`/users/${userID}`, 'GET', true)
    
    let activeStatus = false;
    
    request.onload = function() {
    
      let data = JSON.parse(this.response)
    
      // Status 200 = Success. Status 400 = Problem.  This says if it's successful and no problems, then execute
      if (request.status >= 200 && request.status < 400) {
      const customer = data.data;
      
      const edit_url_link = document.getElementById("edit-customer-link")
      edit_url_link.href= `/customers/edit?id=${customer.ID}`; 
     
      const cardContainer = document.getElementById("customers-container")
      
      const customer_title_bg = document.getElementById("customer-title-bg")
      
      const customer_name_title = customer_title_bg.getElementsByTagName('h2')[0];
      customer_name_title.textContent = `${customer.FirstName} ${customer.LastName} ${customer.OtherNames || ''}`
      
      const customer_email = customer_title_bg.getElementsByTagName('p')[0];
      customer_email.textContent = customer.EmailAddress
      
      const member_card = document.getElementById("customer-info-card")
      
      const profile_info = member_card.getElementsByClassName('profile-info')[0]
      const customer_name_profile = profile_info.getElementsByClassName('profile-name')[0]
      customer_name_profile.textContent = `${customer.FirstName} ${customer.LastName} ${customer.OtherNames || ''}`
      
      const member_avatar_class = profile_info.getElementsByClassName('avatar')[0]
      if(customer.ImageUrl !== '') member_avatar_class.style.backgroundImage = "url('" + customer.ImageUrl + "')";
      
      const profile_details = profile_info.getElementsByClassName('profile-details')[0]
      const div = profile_details.getElementsByTagName('div')[0];
      div.textContent = customer.EmailAddress
      
      const phone_id = document.getElementById("phone")
      phone_id.textContent = customer.PhoneNumber
      
      const email_id = document.getElementById("email")
      email_id.textContent = customer.EmailAddress
      
      const dob_id = document.getElementById("dob")
      dob.textContent = readableDate(customer.Dob)
      
      const bvn_id = document.getElementById("bvn")
      bvn_id.textContent = customer.Bvn
      
      const active_status_id = document.getElementById("active-status")
      if(customer.Active) {
          let deactivate_button_el = document.getElementById("deactivate-customer");
          deactivate_button_el.classList.remove("hide")
        active_status_id.innerHTML = '<span class="text-success">Active</span>'
      } else {
          let activate_button_el = document.getElementById("activate-customer");
          activate_button_el.classList.remove("hide")
        active_status_id.innerHTML = '<span class="text-danger">Inactive</span>'
      }
      
      const gender_id = document.getElementById("gender")
      gender_id.textContent = readGender(customer.Gender)
      
      const kyc_level_id = document.getElementById("kyc-level")
      kyc_level_id.textContent = customer.KycLevel
      
      const deposit_accounts = document.getElementById("deposit-accounts")
      deposit_accounts.textContent = customer.DepositAccounts || ''
      
      const loan_accounts = document.getElementById("loan-accounts")
      loan_accounts.textContent = customer.LoanAccounts || ''
      
      const saved_beneficiaries = document.getElementById("saved-beneficiaries")
      saved_beneficiaries.textContent = customer.SavedBeneficiaries || ''
      
      const customer_meta = document.getElementById("customer-meta")
      customer_meta.textContent = customer.Meta || ''
      
      const customer_ids = document.getElementById("customer-ids")
      customer_ids.textContent = customer.IDs || ''
      
      const customer_device_id = document.getElementById("customer-device-id")
      customer_device_id.textContent = customer.DeviceID
      
      const address_type = document.getElementById("address-type")
      address_type.textContent = readAddressType(customer.AddressType)
      
      const address_street = document.getElementById("address-street")
      address_street.textContent = customer.Street
      
      const address_street_2 = document.getElementById("address-street-2")
      address_street_2.textContent = customer.Street2
        
      const address_town = document.getElementById("address-town")
      address_town.textContent = customer.Town
      
      const address_state = document.getElementById("address-state")
      address_state.textContent = customer.State
      
      const address_lga = document.getElementById("address-lga")
      address_lga.textContent = customer.Lga
      
      let workInformation = customer.WorkInformation
      const work_name = document.getElementById("work-name")
      work_name.textContent = workInformation.Name
      
      const work_role_type = document.getElementById("work-role-type")
      work_role_type.textContent = readRoleType(workInformation.RoleType)
      
      let workAddress = workInformation.Address
      const work_address_type = document.getElementById("work-address-type")
      work_address_type.textContent = readAddressType(workAddress.AddressType)
      
      const work_street = document.getElementById("work-street")
      work_street.textContent = workAddress.Street
      
      const work_street_2 = document.getElementById("work-street-2")
      work_street_2.textContent = workAddress.Street2
      
      const work_town = document.getElementById("work-town")
      work_town.textContent = workAddress.Town
      
      const work_state = document.getElementById("work-state")
      work_state.textContent = workAddress.State
      
      const work_lga = document.getElementById("work-lga")
      work_lga.textContent = workAddress.Lga
      
      } else {
           console.log('error');
     }
    }
    
    //send request
    request.send();
    
    //activate customers
    document.getElementById("activate-customer").addEventListener("click", function() { 
        const status = true;
      updateCustomerStatus(status)
    });
    //deactivate customer
    document.getElementById("deactivate-customer").addEventListener("click", function() { 
        const status = false;
      updateCustomerStatus(status)
    });;
    
    function updateCustomerStatus(activeStatus) {
        let request = cbrRequest(`/users/${userID}/activate/${activeStatus}`, 'PATCH', true)
      
      request.onload = function() {
      
        if (request.status >= 200 && request.status < 400) {
          document.location.reload()
        } else {
            return false
        } 
      }
      
      request.send()
    }
    
    </script>